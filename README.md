# 🧾 E-Invoice Smart Accounting Backend
> 📊 An automated e-invoice crawler and intelligent categorization accounting backend service

- The following content is generated by AI, could have mistake

## 🌟 Project Overview

This is an intelligent e-invoice processing system that automatically crawls your consumption records from Taiwan's e-invoice platform, performs smart categorization and description through AI technology, and finally pushes the results to Telegram and can be imported into the Cashew accounting application.

## Prepare Mongo DB before you start


## 🏗️ System Architecture

```
📦 Project Structure
├── 🎯 run_service.py        # Main service entry point
├── 🎮 manager.py            # Core invoice management logic
├── 📅 last_month.py         # Manual fetch for last month's invoices
├── 🐳 docker-compose.yml    # Docker container configuration
├── 📋 requirements.txt      # Python package dependencies
└── 📁 src/                  # Core modules
    ├── 🕷️ crawl_tools.py    # Crawler utility functions
    ├── 🧾 einvoice.py       # Invoice data models
    ├── 🤖 ai.py             # AI categorization and description
    ├── 📱 telegram_bot.py   # Telegram bot
    └── 🌐 chrome.py         # Chrome browser management
```

## 🚀 How to Use

### ⚙️ Environment Variable Setup

Before getting started, please set up the following environment variables (refer to `docker-compose.yml`):

```bash
TELEGRAM_BOT_API=Your Telegram Bot Token (optional)
TELEGRAM_CHAT_ID=Your Telegram Chat ID (optional)
EINVOICE_PHONE=Your e-invoice platform phone number (required)
EINVOICE_PASSWORD=Your e-invoice platform password (required)
MONGO_DB_URL=You MongoDB URL (required)
OPENAI_API_KEY=Your OpenAI API key (optional)
OPENAI_ENDPOINT=OpenAI API endpoint (optional, defaults to official endpoint)

```

### 🔧 Standard Installation

```bash
# 📥 Clone the project
git clone https://github.com/arpangl/einvoice-accounting-backend.git
cd einvoice-accounting-backend

# 📦 Install dependencies
pip install -r requirements.txt

# 🚀 Start the service
python run_service.py
```

### 🐳 Docker Installation (Recommended)

```bash
# 🏗️ Build and start containers
docker compose up -d --build
```

> 💡 **Why Docker is Recommended?**
> - 📦 Environment consistency, avoiding dependency issues
> - 🔄 Auto-restart, automatically restarts when errors occur during crawling
> - 🛡️ Isolation, won't affect your system environment
> - ⏰ Timezone set to Taipei time, ensuring scheduled tasks run correctly

## 🎯 Core Features

### 🤖 AI Smart Processing
- **Precise Categorization**: Automatically categorizes consumption items into 10 major categories
- **Fun Descriptions**: Adds comments about your spending habits in a cute tone

### 📱 Real-time Notifications
- **Telegram Integration**: New invoices pushed to your phone immediately
- **One-click Import**: Direct link to Cashew accounting application

### ⏰ Smart Scheduling
- **Random Intervals**: Automatically checks for new invoices every 1.7-6 hours
- **Monthly Batch**: Automatically fetches all invoices from the previous month on the 1st of each month

### 🛡️ Data Security
- **Deduplication**: Automatically checks to avoid duplicate storage
- **Structured Storage**: Complete invoice details preserved in MongoDB

## 📊 Data Processing Flow

1. 🔐 **Authentication** → Automatically logs into the e-invoice platform
2. 📋 **Data Crawling** → Retrieves invoice lists and detailed content
3. 🤖 **AI Processing** → Smart categorization and description generation
4. 💾 **Data Storage** → Stores in MongoDB database
5. 📱 **Push Notification** → Sends to Telegram
6. ⏰ **Schedule Wait** → Waits for the next execution cycle

---
💡 **Tip**: If you encounter any issues, please check if environment variables are correctly set, or check the `accounting-backend.log` log file.