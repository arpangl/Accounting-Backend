# ğŸ§¾ E-Invoice Smart Accounting Backend
> ğŸ“Š An automated e-invoice crawler and intelligent categorization accounting backend service

- The following content is generated by AI, could have mistake

## ğŸŒŸ Project Overview

This is an intelligent e-invoice processing system that automatically crawls your consumption records from Taiwan's e-invoice platform, performs smart categorization and description through AI technology, and finally pushes the results to Telegram and can be imported into the Cashew accounting application.

## Prepare Mongo DB before you start


## ğŸ—ï¸ System Architecture

```
ğŸ“¦ Project Structure
â”œâ”€â”€ ğŸ¯ run_service.py        # Main service entry point
â”œâ”€â”€ ğŸ® manager.py            # Core invoice management logic
â”œâ”€â”€ ğŸ“… last_month.py         # Manual fetch for last month's invoices
â”œâ”€â”€ ğŸ³ docker-compose.yml    # Docker container configuration
â”œâ”€â”€ ğŸ“‹ requirements.txt      # Python package dependencies
â””â”€â”€ ğŸ“ src/                  # Core modules
    â”œâ”€â”€ ğŸ•·ï¸ crawl_tools.py    # Crawler utility functions
    â”œâ”€â”€ ğŸ§¾ einvoice.py       # Invoice data models
    â”œâ”€â”€ ğŸ¤– ai.py             # AI categorization and description
    â”œâ”€â”€ ğŸ“± telegram_bot.py   # Telegram bot
    â””â”€â”€ ğŸŒ chrome.py         # Chrome browser management
```

## ğŸš€ How to Use

### âš™ï¸ Environment Variable Setup

Before getting started, please set up the following environment variables (refer to `docker-compose.yml`):

```bash
TELEGRAM_BOT_API=Your Telegram Bot Token (optional)
TELEGRAM_CHAT_ID=Your Telegram Chat ID (optional)
EINVOICE_PHONE=Your e-invoice platform phone number (required)
EINVOICE_PASSWORD=Your e-invoice platform password (required)
MONGO_DB_URL=You MongoDB URL (required)
OPENAI_API_KEY=Your OpenAI API key (optional)
OPENAI_ENDPOINT=OpenAI API endpoint (optional, defaults to official endpoint)

```

### ğŸ”§ Standard Installation

```bash
# ğŸ“¥ Clone the project
git clone https://github.com/arpangl/einvoice-accounting-backend.git
cd einvoice-accounting-backend

# ğŸ“¦ Install dependencies
pip install -r requirements.txt

# ğŸš€ Start the service
python run_service.py
```

### ğŸ³ Docker Installation (Recommended)

```bash
# ğŸ—ï¸ Build and start containers
docker compose up -d --build
```

> ğŸ’¡ **Why Docker is Recommended?**
> - ğŸ“¦ Environment consistency, avoiding dependency issues
> - ğŸ”„ Auto-restart, automatically restarts when errors occur during crawling
> - ğŸ›¡ï¸ Isolation, won't affect your system environment
> - â° Timezone set to Taipei time, ensuring scheduled tasks run correctly

## ğŸ¯ Core Features

### ğŸ¤– AI Smart Processing
- **Precise Categorization**: Automatically categorizes consumption items into 10 major categories
- **Fun Descriptions**: Adds comments about your spending habits in a cute tone

### ğŸ“± Real-time Notifications
- **Telegram Integration**: New invoices pushed to your phone immediately
- **One-click Import**: Direct link to Cashew accounting application

### â° Smart Scheduling
- **Random Intervals**: Automatically checks for new invoices every 1.7-6 hours
- **Monthly Batch**: Automatically fetches all invoices from the previous month on the 1st of each month

### ğŸ›¡ï¸ Data Security
- **Deduplication**: Automatically checks to avoid duplicate storage
- **Structured Storage**: Complete invoice details preserved in MongoDB

## ğŸ“Š Data Processing Flow

1. ğŸ” **Authentication** â†’ Automatically logs into the e-invoice platform
2. ğŸ“‹ **Data Crawling** â†’ Retrieves invoice lists and detailed content
3. ğŸ¤– **AI Processing** â†’ Smart categorization and description generation
4. ğŸ’¾ **Data Storage** â†’ Stores in MongoDB database
5. ğŸ“± **Push Notification** â†’ Sends to Telegram
6. â° **Schedule Wait** â†’ Waits for the next execution cycle

---
ğŸ’¡ **Tip**: If you encounter any issues, please check if environment variables are correctly set, or check the `accounting-backend.log` log file.